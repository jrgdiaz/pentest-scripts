#This script will loop through all the .nasl and .nbin files and look for references in other sources like exploitdb and packetstorm to find potential exploits.
#idea from https://avleonov.com/2017/11/02/exploitability-attributes-of-nessus-plugins-good-bad-and-vulners/
#"The use of external exploit databases can greatly help with the search of exploitable vulnerabilities detected by Nessus."
#this is just a PoC...
import os
import sys
from requests_html import HTMLSession

session = HTMLSession()
url = 'https://vulners.com'
path = 'C:\\ProgramData\\Tenable\\Nessus\\nessus\\plugins'
nessus_nasl = os.listdir(path)
file_ = open("exploits\\exploits.csv",'a')
file_.write("\n")

for nasl in nessus_nasl:
        r = session.get(url+'/nessus/'+nasl)
        r.html.render(timeout = 25)
        references = r.html.find('.vulners-link-initial')
        for i in range(0,len(references)):
                sys.stdout.write('\r[{:2.2f} %] trying {:>64}'.format((100.0*i)//len(nessus_nasl), nasl))
                sys.stdout.flush()
                reference = references[i].links.pop()
                if ('exploitdb' in reference) or ('packetstorm' in reference):
                    file_ = open("exploits\\exploits.csv",'a')
                    file_.write(nasl+","+url+reference+"\n")
                    file_.close()
                        





